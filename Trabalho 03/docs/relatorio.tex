% Rafael Sartori M. dos Santos, 186154
\documentclass[brazilian,a4paper,twocolumn]{article}

% Título
\title{MC920 -- Trabalho 3}
\author{Rafael Sartori M. Santos, 186154}
\date{17 de outubro de 2019}

% Configuração do documento
\setlength{\parskip}{3pt}
\usepackage[utf8]{inputenc} % tipo de documento UTF-8
\usepackage{mathtools} % permitir expressões matemáticas
\usepackage{breqn} % equações quebradas em várias linhas automaticamente
\usepackage{babel} % configuração da lingua portuguesa
\usepackage{caption} % para legenda de tabelas e figuras
\usepackage[
    pdfauthor={Rafael Sartori M. Santos},
    pdftitle={Trabalho 3 -- MC920},
    pdfproducer={LaTeX (texlive) com hyperref},
    hidelinks
]{hyperref} % para links externos (href)
\usepackage{cleveref} % para referenciar tabelas e figuras melhor
\usepackage{indentfirst} % indentação de todo primeiro parágrafo
\usepackage{graphicx} % para adicionar imagens
\graphicspath{{../imgs/}} % atalho para o caminho das imagens
\usepackage{float} % para fixar posição de imagens
\usepackage{subcaption} % para imagens ficarem lado a lado
% Usamos geometry pois dá mais espaço que fullpage
%\usepackage{geometry} % alterar geometria do papel
%\geometry{a4paper,left=1.7cm,right=1.7cm,top=1cm,bottom=2.0cm} % menor margem
\usepackage{fullpage} % utilizamos uma versão com menos espaçamento nas bordas
\usepackage{verbatim} % pacote para incluir arquivos em verbatim
\usepackage{mdframed} % para enquadrar coisas

% Início do documento
\begin{document}

\maketitle


\section{Introdução}

    O objetivo deste trabalho é separar, rotular, contar objetos desconexos utilizando limiarização e análise de vizinhança, verificar propriedades, como área, perímetro, centroide e, por fim, classificar entre pequeno, médio e grande pela área ocupada.

    Faremos isso utilizando um programa escrito em \emph{Python} utilizando a biblioteca padrão, \href{https://opencv.org/}{\emph{OpenCV}} para processar as imagens e \href{https://matplotlib.org/}{\emph{Matplotlib}} para histograma da área calculada dos objetos da imagem.


\section{Método}

    O trabalho é facilmente divisível em várias etapas. Para cumprir todos os objetivos, será necessário:
    \begin{itemize}
        \item monocromatizar a imagem de entrada,
        \item rotular objetos desconexos,
        \item contá-los,
        \item extrair propriedades,
        \item classificá-los quanto à área.
    \end{itemize}

    A razão para aplicação de cada um desses passos será explicada junto com sua metodologia.

    Para a aplicação de fato, no entanto, iremos utilizar funções já implementadas de \emph{OpenCV}, cujo funcionamento não diferente tanto dos métodos descritos nesta seção.

    \subsection{Monocromatização}

        Como a imagem de entrada é colorida, teremos mais de uma camada de cor e isso tornará difícil a identificação de um objeto ou fundo. Portanto, qualquer tipo de transformação que produza uma imagem de camada única é suficiente.

        Para produzir uma saída em apenas uma camada, podemos utilizar uma função que tem como parâmetro as várias camadas ou ainda fazer uma limiarização.

    \subsection{Rotulação e contagem}
    \label{sec:metodo-rotulacao}

        Com a imagem monocromática, podemos identificar os objetos através do agrupamento usando \texttt{vizinhança-4} ou \texttt{vizinhança-8}. Podemos fazer isso seguindo este plano:
        \begin{itemize}
            \item inicializamos uma variável que é o número do objeto que estamos identificando atualmente (começa com zero);
            \item inicializamos a matriz de ``resposta'' de mesma dimensão que a entrada com zero (ela guardará o rótulo e quais pontos pertencem a esse objeto);
            \item percorremos a imagem toda; ao encontrarmos um objeto (não fundo), fazemos:
            \begin{itemize}
                \item incrementamos a variável do objeto que estamos identificando, esse é o número do objeto atual;
                \item navegaremos dentro dele utilizando a vizinhança selecionada, marcando numa matriz de ``resposta'' o número do objeto atual;
                \item ao não possuir mais pontos que não são fundo alcançáveis pela vizinhança, continuamos percorrendo a imagem.
            \end{itemize}
            \item terminamos a imagem tendo percorrido todos os pontos e rotulado todos os objetos desconexos entre si.
        \end{itemize}

        Dessa forma, automaticamente já contamos os objetos presentes, é o valor final da variável do número de objetos que identificamos.

        Com essa matriz, será possível contar a área, identificar perímetro e encontrar centroide de cada objeto.

    \subsection{Medir área e perímetro}

        Do resultado do método anterior (\ref{sec:metodo-rotulacao}), podemos medir a área simplesmente contando os pontos que possuem mesmo valor ao rótulo do objeto. Por exemplo, para o rótulo 4, contamos os pontos cujo valor é 4 na matriz retornada.

        Já para o perímetro, é mais difícil: será necessário encontrar o contorno desses objetos e depois contar os pontos pertencentes a ele. Há algumas maneiras de se fazer isso, por exemplo: encontrando os que possuem alguma vizinhança com o fundo, utilizando morfologia matemática na imagem.

    \subsection{Calculando centroide}

        A centroide da imagem é a posição central $ (C_x, C_y) $ do objeto na imagem bidimensional, ou seja, a posição mediana em relação a área. Pode ser calculada por decomposição geométrica em pequenos retângulos (os pontos) através da \cref{eq:centroide}.

        \begin{equation}
            \label{eq:centroide}
            C_l = \frac{\sum C_{i,l} A_i}{\sum A_i}
        \end{equation}

        Onde $l$ é a dimensão em que queremos calcular a centroide, $C_{i,l}$ é a coordenada na dimensão $l$ da $i$-ésima parte da decomposição do objeto $C$. Essa decomposição é feita automaticamente pela digitalização da imagem (em pequenos quadrados, os \textit{pixels}).

    \subsection{Classificação quanto a àrea}

        A classificação é mais simples. Com a área $A$ do objeto calculada, basta verificar em qual categoria se encaixa. São elas:
        \begin{itemize}
            \item pequeno, se $A < 1500$;
            \item médio, se $A \in [1500, 3000)$;
            \item grande, se $A \geq 3000$.
        \end{itemize}

        Com a classificação, produzimos um histograma em que, no eixo horizontal, temos o tamanho do objeto e, no vertical, a quantidade de objetos.

\section{Resultados}

    .


\section{Conclusão}

    .


\end{document}
